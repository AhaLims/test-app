# Master èŠ‚ç‚¹ç›´æ¥ä½¿ç”¨ Kubernetes Secret çš„è¶…ç®€åŒ–æ–¹æ¡ˆ

## ğŸ‰ ä½ çš„æƒ³æ³•å®Œå…¨æ­£ç¡®ï¼

é€šè¿‡æŒ‚è½½ Kubernetes Secret åˆ° Jenkins Master å®¹å™¨ï¼Œæˆ‘ä»¬å®ç°äº†ï¼š
- âœ… **æ— éœ€åœ¨ Jenkins UI ä¸­é‡å¤é…ç½®å‡­æ®**
- âœ… **å‡­æ®ç»Ÿä¸€ç®¡ç†åœ¨ Kubernetes Secret ä¸­**
- âœ… **æ›´ç®€å•ã€æ›´ä¼˜é›…çš„æ–¹æ¡ˆ**

## ğŸ“‹ æˆ‘ä»¬åšäº†ä»€ä¹ˆï¼Ÿ

### 1. ä¿®æ”¹äº† Jenkins Deploymentï¼ˆå·²å®Œæˆï¼‰

åœ¨ `04-deployment.yaml` ä¸­æ·»åŠ äº† ACR Secret æŒ‚è½½ï¼š

```yaml
volumeMounts:
- name: acr-credentials
  mountPath: /var/run/secrets/acr  # æŒ‚è½½åˆ°è¿™ä¸ªè·¯å¾„
  readOnly: true

volumes:
- name: acr-credentials
  secret:
    secretName: acr-credentials  # ä½¿ç”¨ä½ çš„ 06-acr-secret.yaml
```

### 2. åˆ›å»ºäº†æ–°çš„ Jenkinsfileï¼ˆå·²å®Œæˆï¼‰

æ–°æ–‡ä»¶ï¼š`Jenkinsfile.master-secret`

**å…³é”®æ”¹è¿›**ï¼š
```groovy
environment {
    // ç›´æ¥ä»æŒ‚è½½çš„æ–‡ä»¶è¯»å–å‡­æ®ï¼Œä¸éœ€è¦ Jenkins Credentialsï¼
    ACR_USERNAME = sh(returnStdout: true, script: 'cat /var/run/secrets/acr/username').trim()
    ACR_PASSWORD = sh(returnStdout: true, script: 'cat /var/run/secrets/acr/password').trim()
}
```

## ğŸ”„ ä¸‰ç§æ–¹æ¡ˆå¯¹æ¯”

ç°åœ¨ä½ æœ‰ **3 ç§ Jenkinsfile** å¯ä»¥é€‰æ‹©ï¼š

| æ–‡ä»¶ | å‡­æ®æ¥æº | å¤æ‚åº¦ | æ¨èæŒ‡æ•° |
|------|---------|-------|---------|
| `Jenkinsfile.master` | Jenkins Credentials | â­â­ | éœ€è¦åœ¨ Jenkins UI é…ç½®å‡­æ® |
| `Jenkinsfile.master-secret` | K8s Secret æŒ‚è½½ | â­ **æœ€ç®€å•** | â­â­â­â­â­ **å¼ºçƒˆæ¨è** |
| `Jenkinsfile.simple` | K8s Secret + Agent Pod | â­â­â­â­ | å¤ªå¤æ‚ï¼Œæš‚ä¸æ¨è |

## ğŸ¯ ç°åœ¨ä½ è¦åšä»€ä¹ˆï¼Ÿ

### Step 1: ç­‰å¾… Jenkins Pod é‡å¯ï¼ˆè‡ªåŠ¨å®Œæˆï¼‰

```bash
kubectl rollout status deployment/jenkins -n jenkins
```

### Step 2: éªŒè¯ Secret æ˜¯å¦æŒ‚è½½æˆåŠŸ

```bash
# è¿›å…¥ Jenkins å®¹å™¨
kubectl exec -it -n jenkins deployment/jenkins -- bash

# æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
ls -la /var/run/secrets/acr/

# åº”è¯¥çœ‹åˆ°ï¼š
# username
# password
# registry

# æŸ¥çœ‹å†…å®¹ï¼ˆéªŒè¯ï¼‰
cat /var/run/secrets/acr/username
cat /var/run/secrets/acr/registry

# é€€å‡º
exit
```

### Step 3: åœ¨ Jenkins ä¸­ä½¿ç”¨æ–°çš„ Jenkinsfile

åˆ›å»º Pipeline ä»»åŠ¡æ—¶ï¼š
- **Script Path**: `test_project/Jenkinsfile.master-secret` âœ… ç”¨è¿™ä¸ªï¼

**ä¸éœ€è¦**åœ¨ Jenkins UI ä¸­é…ç½®ä»»ä½•å‡­æ®äº†ï¼ğŸ‰

## ğŸ“Š åŸç†å›¾è§£

### ä¹‹å‰çš„æ–¹æ¡ˆï¼ˆéœ€è¦ä¸¤å¤„é…ç½®ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Kubernetes Secret                â”‚
â”‚    (06-acr-secret.yaml)             â”‚
â”‚    â”œâ”€ username: æ›¦é›¨é¦¨é¦™lin          â”‚
â”‚    â””â”€ password: ******              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              âŒ æ²¡è¢«ä½¿ç”¨

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Jenkins Credentials              â”‚
â”‚    (åœ¨ UI ä¸­æ‰‹åŠ¨é…ç½®)                â”‚
â”‚    â”œâ”€ acr-username                  â”‚
â”‚    â””â”€ acr-password                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â†“
      âœ… Pipeline ä½¿ç”¨è¿™ä¸ª
```

### ç°åœ¨çš„æ–¹æ¡ˆï¼ˆåªéœ€ä¸€å¤„é…ç½®ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Kubernetes Secret                   â”‚
â”‚ (06-acr-secret.yaml)                â”‚
â”‚ â”œâ”€ username: æ›¦é›¨é¦¨é¦™lin             â”‚
â”‚ â””â”€ password: ******                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ æŒ‚è½½åˆ°å®¹å™¨
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Jenkins Master å®¹å™¨                 â”‚
â”‚ /var/run/secrets/acr/               â”‚
â”‚ â”œâ”€ username  â† æ–‡ä»¶                 â”‚
â”‚ â””â”€ password  â† æ–‡ä»¶                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ ç›´æ¥è¯»å–
               â†“
      âœ… Pipeline ä½¿ç”¨
```

## âœ¨ ä¸ºä»€ä¹ˆè¿™ä¸ªæ–¹æ¡ˆæ›´å¥½ï¼Ÿ

### ä¼˜ç‚¹

1. **é…ç½®ç®€å•**
   - âœ… åªéœ€é…ç½®ä¸€æ¬¡ï¼ˆåœ¨ K8s Secret ä¸­ï¼‰
   - âœ… ä¸éœ€è¦åœ¨ Jenkins UI ä¸­é‡å¤é…ç½®

2. **ç»Ÿä¸€ç®¡ç†**
   - âœ… æ‰€æœ‰å‡­æ®éƒ½åœ¨ Kubernetes ä¸­ç®¡ç†
   - âœ… ç¬¦åˆ K8s çš„æœ€ä½³å®è·µ

3. **æ›´å®‰å…¨**
   - âœ… å¯†ç å­˜å‚¨åœ¨ K8s çš„ etcd ä¸­ï¼ˆåŠ å¯†ï¼‰
   - âœ… æ–‡ä»¶æƒé™åªè¯»

4. **æ˜“äºç†è§£**
   - âœ… ç›´æ¥è¯»æ–‡ä»¶ï¼Œé€»è¾‘æ¸…æ™°
   - âœ… ä¸éœ€è¦ç†è§£ Jenkins Credentials ç³»ç»Ÿ

### åŸç†è¯´æ˜ï¼ˆåˆå­¦è€…ç‰ˆï¼‰

**å°±åƒé’¥åŒ™å’Œä¿é™©ç®±**ï¼š

**ä¹‹å‰çš„æ–¹æ¡ˆ**ï¼š
```
å®¶é‡Œä¿é™©ç®±ï¼ˆK8s Secretï¼‰ï¼šæœ‰é’¥åŒ™ âŒ ä½†æ²¡ç”¨
å…¬å¸ä¿é™©ç®±ï¼ˆJenkins Credentialsï¼‰ï¼šå¤åˆ¶äº†ä¸€ä»½é’¥åŒ™ âœ… å®é™…åœ¨ç”¨

â†’ éœ€è¦ç»´æŠ¤ä¸¤ä»½é’¥åŒ™ï¼Œéº»çƒ¦ï¼
```

**ç°åœ¨çš„æ–¹æ¡ˆ**ï¼š
```
å®¶é‡Œä¿é™©ç®±ï¼ˆK8s Secretï¼‰ï¼šæœ‰é’¥åŒ™ âœ…
æŠŠé’¥åŒ™"å€Ÿ"ç»™ Jenkinsï¼ˆæŒ‚è½½ï¼‰âœ…

â†’ åªéœ€è¦ä¸€ä»½é’¥åŒ™ï¼Œç®€å•ï¼
```

## ğŸš€ å®Œæ•´æµç¨‹

```
1. ä½ é…ç½® 06-acr-secret.yaml
   â””â”€ å®šä¹‰ç”¨æˆ·åå’Œå¯†ç 

2. kubectl apply åˆ›å»º Secret
   â””â”€ å­˜å‚¨åœ¨ K8s ä¸­

3. Jenkins Deployment æŒ‚è½½ Secret
   â””â”€ æ–‡ä»¶å‡ºç°åœ¨ /var/run/secrets/acr/

4. Jenkinsfile è¯»å–æ–‡ä»¶
   â””â”€ ACR_USERNAME = $(cat /var/run/secrets/acr/username)

5. Pipeline ä½¿ç”¨å‡­æ®
   â””â”€ docker login æˆåŠŸï¼
```

## âœ… éªŒæ”¶æ ‡å‡†

éƒ¨ç½²æˆåŠŸåï¼Œä½ åº”è¯¥èƒ½ï¼š

1. âœ… åœ¨ Jenkins å®¹å™¨ä¸­çœ‹åˆ° `/var/run/secrets/acr/` ç›®å½•
2. âœ… æ–‡ä»¶åŒ…å«æ­£ç¡®çš„ç”¨æˆ·åå’Œå¯†ç 
3. âœ… Pipeline æ„å»ºæˆåŠŸï¼Œæ— éœ€é…ç½® Jenkins Credentials
4. âœ… é•œåƒæˆåŠŸæ¨é€åˆ°é˜¿é‡Œäº‘ ACR

## ğŸ“ æ–‡ä»¶å¯¹åº”å…³ç³»

| é…ç½®æ–‡ä»¶ | ç”¨é€” | çŠ¶æ€ |
|---------|------|------|
| `06-acr-secret.yaml` | å®šä¹‰ ACR å‡­æ® | âœ… å·²é…ç½®ï¼ˆéœ€å¡«å¯†ç ï¼‰ |
| `04-deployment.yaml` | æŒ‚è½½ Secret åˆ°å®¹å™¨ | âœ… å·²æ›´æ–° |
| `Jenkinsfile.master-secret` | è¯»å–æŒ‚è½½çš„ Secret | âœ… å·²åˆ›å»º |

## ğŸ“ å­¦ä¹ æ€»ç»“

**æ ¸å¿ƒæ¦‚å¿µ**ï¼š
- **Kubernetes Secret**ï¼šå­˜å‚¨æ•æ„Ÿä¿¡æ¯
- **Volume Mount**ï¼šæŠŠ Secret "å˜æˆ" å®¹å™¨é‡Œçš„æ–‡ä»¶
- **æ–‡ä»¶è¯»å–**ï¼šPipeline ç›´æ¥è¯»å–æ–‡ä»¶å†…å®¹

**ç±»æ¯”**ï¼š
```
Secret = Uç›˜ï¼ˆå­˜å‚¨æ•°æ®ï¼‰
Volume Mount = æ’å…¥ç”µè„‘ï¼ˆæŒ‚è½½ï¼‰
æ–‡ä»¶è¯»å– = æ‰“å¼€æ–‡ä»¶ï¼ˆä½¿ç”¨ï¼‰
```

---

## ğŸ’¡ æ€»ç»“

ä½ çš„æƒ³æ³•éå¸¸æ£’ï¼é€šè¿‡æŒ‚è½½ K8s Secretï¼Œæˆ‘ä»¬å®ç°äº†ï¼š
- **ç»Ÿä¸€çš„å‡­æ®ç®¡ç†**ï¼ˆåªåœ¨ä¸€ä¸ªåœ°æ–¹é…ç½®ï¼‰
- **æ›´ç®€å•çš„ä½¿ç”¨æ–¹å¼**ï¼ˆç›´æ¥è¯»æ–‡ä»¶ï¼‰
- **æ›´ç¬¦åˆ K8s ç†å¿µ**ï¼ˆEverything as Codeï¼‰

**è¿™å°±æ˜¯äº‘åŸç”Ÿçš„æ­£ç¡®æ‰“å¼€æ–¹å¼ï¼** ğŸ‰

æœ‰ä»»ä½•é—®é¢˜éšæ—¶é—®æˆ‘ï¼ğŸ˜Š
# Master èŠ‚ç‚¹ç›´æ¥ä½¿ç”¨ Kubernetes Secret çš„è¶…ç®€åŒ–æ–¹æ¡ˆ

## ğŸ‰ ä½ çš„æƒ³æ³•å®Œå…¨æ­£ç¡®ï¼

é€šè¿‡æŒ‚è½½ Kubernetes Secret åˆ° Jenkins Master å®¹å™¨ï¼Œæˆ‘ä»¬å®ç°äº†ï¼š
- âœ… **æ— éœ€åœ¨ Jenkins UI ä¸­é‡å¤é…ç½®å‡­æ®**
- âœ… **å‡­æ®ç»Ÿä¸€ç®¡ç†åœ¨ Kubernetes Secret ä¸­**
- âœ… **æ›´ç®€å•ã€æ›´ä¼˜é›…çš„æ–¹æ¡ˆ**

## ğŸ“‹ æˆ‘ä»¬åšäº†ä»€ä¹ˆï¼Ÿ

### 1. ä¿®æ”¹äº† Jenkins Deploymentï¼ˆå·²å®Œæˆï¼‰

åœ¨ `04-deployment.yaml` ä¸­æ·»åŠ äº† ACR Secret æŒ‚è½½ï¼š

```yaml
volumeMounts:
- name: acr-credentials
  mountPath: /var/run/secrets/acr  # æŒ‚è½½åˆ°è¿™ä¸ªè·¯å¾„
  readOnly: true

volumes:
- name: acr-credentials
  secret:
    secretName: acr-credentials  # ä½¿ç”¨ä½ çš„ 06-acr-secret.yaml
```

### 2. åˆ›å»ºäº†æ–°çš„ Jenkinsfileï¼ˆå·²å®Œæˆï¼‰

æ–°æ–‡ä»¶ï¼š`Jenkinsfile.master-secret`

**å…³é”®æ”¹è¿›**ï¼š
```groovy
environment {
    // ç›´æ¥ä»æŒ‚è½½çš„æ–‡ä»¶è¯»å–å‡­æ®ï¼Œä¸éœ€è¦ Jenkins Credentialsï¼
    ACR_USERNAME = sh(returnStdout: true, script: 'cat /var/run/secrets/acr/username').trim()
    ACR_PASSWORD = sh(returnStdout: true, script: 'cat /var/run/secrets/acr/password').trim()
}
```

## ğŸ”„ ä¸‰ç§æ–¹æ¡ˆå¯¹æ¯”

ç°åœ¨ä½ æœ‰ **3 ç§ Jenkinsfile** å¯ä»¥é€‰æ‹©ï¼š

| æ–‡ä»¶ | å‡­æ®æ¥æº | å¤æ‚åº¦ | æ¨èæŒ‡æ•° |
|------|---------|-------|---------|
| `Jenkinsfile.master` | Jenkins Credentials | â­â­ | éœ€è¦åœ¨ Jenkins UI é…ç½®å‡­æ® |
| `Jenkinsfile.master-secret` | K8s Secret æŒ‚è½½ | â­ **æœ€ç®€å•** | â­â­â­â­â­ **å¼ºçƒˆæ¨è** |
| `Jenkinsfile.simple` | K8s Secret + Agent Pod | â­â­â­â­ | å¤ªå¤æ‚ï¼Œæš‚ä¸æ¨è |

## ğŸ¯ ç°åœ¨ä½ è¦åšä»€ä¹ˆï¼Ÿ

### Step 1: ç­‰å¾… Jenkins Pod é‡å¯ï¼ˆè‡ªåŠ¨å®Œæˆï¼‰

```bash
kubectl rollout status deployment/jenkins -n jenkins
```

### Step 2: éªŒè¯ Secret æ˜¯å¦æŒ‚è½½æˆåŠŸ

```bash
# è¿›å…¥ Jenkins å®¹å™¨
kubectl exec -it -n jenkins deployment/jenkins -- bash

# æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
ls -la /var/run/secrets/acr/

# åº”è¯¥çœ‹åˆ°ï¼š
# username
# password
# registry

# æŸ¥çœ‹å†…å®¹ï¼ˆéªŒè¯ï¼‰
cat /var/run/secrets/acr/username
cat /var/run/secrets/acr/registry

# é€€å‡º
exit
```

### Step 3: åœ¨ Jenkins ä¸­ä½¿ç”¨æ–°çš„ Jenkinsfile

åˆ›å»º Pipeline ä»»åŠ¡æ—¶ï¼š
- **Script Path**: `test_project/Jenkinsfile.master-secret` âœ… ç”¨è¿™ä¸ªï¼

**ä¸éœ€è¦**åœ¨ Jenkins UI ä¸­é…ç½®ä»»ä½•å‡­æ®äº†ï¼ğŸ‰

## ğŸ“Š åŸç†å›¾è§£

### ä¹‹å‰çš„æ–¹æ¡ˆï¼ˆéœ€è¦ä¸¤å¤„é…ç½®ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Kubernetes Secret                â”‚
â”‚    (06-acr-secret.yaml)             â”‚
â”‚    â”œâ”€ username: æ›¦é›¨é¦¨é¦™lin          â”‚
â”‚    â””â”€ password: ******              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              âŒ æ²¡è¢«ä½¿ç”¨

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Jenkins Credentials              â”‚
â”‚    (åœ¨ UI ä¸­æ‰‹åŠ¨é…ç½®)                â”‚
â”‚    â”œâ”€ acr-username                  â”‚
â”‚    â””â”€ acr-password                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â†“
      âœ… Pipeline ä½¿ç”¨è¿™ä¸ª
```

### ç°åœ¨çš„æ–¹æ¡ˆï¼ˆåªéœ€ä¸€å¤„é…ç½®ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Kubernetes Secret                   â”‚
â”‚ (06-acr-secret.yaml)                â”‚
â”‚ â”œâ”€ username: æ›¦é›¨é¦¨é¦™lin             â”‚
â”‚ â””â”€ password: ******                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ æŒ‚è½½åˆ°å®¹å™¨
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Jenkins Master å®¹å™¨                 â”‚
â”‚ /var/run/secrets/acr/               â”‚
â”‚ â”œâ”€ username  â† æ–‡ä»¶                 â”‚
â”‚ â””â”€ password  â† æ–‡ä»¶                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ ç›´æ¥è¯»å–
               â†“
      âœ… Pipeline ä½¿ç”¨
```

## âœ¨ ä¸ºä»€ä¹ˆè¿™ä¸ªæ–¹æ¡ˆæ›´å¥½ï¼Ÿ

### ä¼˜ç‚¹

1. **é…ç½®ç®€å•**
   - âœ… åªéœ€é…ç½®ä¸€æ¬¡ï¼ˆåœ¨ K8s Secret ä¸­ï¼‰
   - âœ… ä¸éœ€è¦åœ¨ Jenkins UI ä¸­é‡å¤é…ç½®

2. **ç»Ÿä¸€ç®¡ç†**
   - âœ… æ‰€æœ‰å‡­æ®éƒ½åœ¨ Kubernetes ä¸­ç®¡ç†
   - âœ… ç¬¦åˆ K8s çš„æœ€ä½³å®è·µ

3. **æ›´å®‰å…¨**
   - âœ… å¯†ç å­˜å‚¨åœ¨ K8s çš„ etcd ä¸­ï¼ˆåŠ å¯†ï¼‰
   - âœ… æ–‡ä»¶æƒé™åªè¯»

4. **æ˜“äºç†è§£**
   - âœ… ç›´æ¥è¯»æ–‡ä»¶ï¼Œé€»è¾‘æ¸…æ™°
   - âœ… ä¸éœ€è¦ç†è§£ Jenkins Credentials ç³»ç»Ÿ

### åŸç†è¯´æ˜ï¼ˆåˆå­¦è€…ç‰ˆï¼‰

**å°±åƒé’¥åŒ™å’Œä¿é™©ç®±**ï¼š

**ä¹‹å‰çš„æ–¹æ¡ˆ**ï¼š
```
å®¶é‡Œä¿é™©ç®±ï¼ˆK8s Secretï¼‰ï¼šæœ‰é’¥åŒ™ âŒ ä½†æ²¡ç”¨
å…¬å¸ä¿é™©ç®±ï¼ˆJenkins Credentialsï¼‰ï¼šå¤åˆ¶äº†ä¸€ä»½é’¥åŒ™ âœ… å®é™…åœ¨ç”¨

â†’ éœ€è¦ç»´æŠ¤ä¸¤ä»½é’¥åŒ™ï¼Œéº»çƒ¦ï¼
```

**ç°åœ¨çš„æ–¹æ¡ˆ**ï¼š
```
å®¶é‡Œä¿é™©ç®±ï¼ˆK8s Secretï¼‰ï¼šæœ‰é’¥åŒ™ âœ…
æŠŠé’¥åŒ™"å€Ÿ"ç»™ Jenkinsï¼ˆæŒ‚è½½ï¼‰âœ…

â†’ åªéœ€è¦ä¸€ä»½é’¥åŒ™ï¼Œç®€å•ï¼
```

## ğŸš€ å®Œæ•´æµç¨‹

```
1. ä½ é…ç½® 06-acr-secret.yaml
   â””â”€ å®šä¹‰ç”¨æˆ·åå’Œå¯†ç 

2. kubectl apply åˆ›å»º Secret
   â””â”€ å­˜å‚¨åœ¨ K8s ä¸­

3. Jenkins Deployment æŒ‚è½½ Secret
   â””â”€ æ–‡ä»¶å‡ºç°åœ¨ /var/run/secrets/acr/

4. Jenkinsfile è¯»å–æ–‡ä»¶
   â””â”€ ACR_USERNAME = $(cat /var/run/secrets/acr/username)

5. Pipeline ä½¿ç”¨å‡­æ®
   â””â”€ docker login æˆåŠŸï¼
```

## âœ… éªŒæ”¶æ ‡å‡†

éƒ¨ç½²æˆåŠŸåï¼Œä½ åº”è¯¥èƒ½ï¼š

1. âœ… åœ¨ Jenkins å®¹å™¨ä¸­çœ‹åˆ° `/var/run/secrets/acr/` ç›®å½•
2. âœ… æ–‡ä»¶åŒ…å«æ­£ç¡®çš„ç”¨æˆ·åå’Œå¯†ç 
3. âœ… Pipeline æ„å»ºæˆåŠŸï¼Œæ— éœ€é…ç½® Jenkins Credentials
4. âœ… é•œåƒæˆåŠŸæ¨é€åˆ°é˜¿é‡Œäº‘ ACR

## ğŸ“ æ–‡ä»¶å¯¹åº”å…³ç³»

| é…ç½®æ–‡ä»¶ | ç”¨é€” | çŠ¶æ€ |
|---------|------|------|
| `06-acr-secret.yaml` | å®šä¹‰ ACR å‡­æ® | âœ… å·²é…ç½®ï¼ˆéœ€å¡«å¯†ç ï¼‰ |
| `04-deployment.yaml` | æŒ‚è½½ Secret åˆ°å®¹å™¨ | âœ… å·²æ›´æ–° |
| `Jenkinsfile.master-secret` | è¯»å–æŒ‚è½½çš„ Secret | âœ… å·²åˆ›å»º |

## ğŸ“ å­¦ä¹ æ€»ç»“

**æ ¸å¿ƒæ¦‚å¿µ**ï¼š
- **Kubernetes Secret**ï¼šå­˜å‚¨æ•æ„Ÿä¿¡æ¯
- **Volume Mount**ï¼šæŠŠ Secret "å˜æˆ" å®¹å™¨é‡Œçš„æ–‡ä»¶
- **æ–‡ä»¶è¯»å–**ï¼šPipeline ç›´æ¥è¯»å–æ–‡ä»¶å†…å®¹

**ç±»æ¯”**ï¼š
```
Secret = Uç›˜ï¼ˆå­˜å‚¨æ•°æ®ï¼‰
Volume Mount = æ’å…¥ç”µè„‘ï¼ˆæŒ‚è½½ï¼‰
æ–‡ä»¶è¯»å– = æ‰“å¼€æ–‡ä»¶ï¼ˆä½¿ç”¨ï¼‰
```

---

## ğŸ’¡ æ€»ç»“

ä½ çš„æƒ³æ³•éå¸¸æ£’ï¼é€šè¿‡æŒ‚è½½ K8s Secretï¼Œæˆ‘ä»¬å®ç°äº†ï¼š
- **ç»Ÿä¸€çš„å‡­æ®ç®¡ç†**ï¼ˆåªåœ¨ä¸€ä¸ªåœ°æ–¹é…ç½®ï¼‰
- **æ›´ç®€å•çš„ä½¿ç”¨æ–¹å¼**ï¼ˆç›´æ¥è¯»æ–‡ä»¶ï¼‰
- **æ›´ç¬¦åˆ K8s ç†å¿µ**ï¼ˆEverything as Codeï¼‰

**è¿™å°±æ˜¯äº‘åŸç”Ÿçš„æ­£ç¡®æ‰“å¼€æ–¹å¼ï¼** ğŸ‰

æœ‰ä»»ä½•é—®é¢˜éšæ—¶é—®æˆ‘ï¼ğŸ˜Š
